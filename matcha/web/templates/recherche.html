{% extends 'base.html' %}

{% block title %}Ma recherche{% endblock %}
{% block content %}
{% include 'nav.html' %}
<meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />

  
    <!-- Load Leaflet from CDN -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
      integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
      crossorigin=""
    ></script>

    <!-- Load Esri Leaflet from CDN -->
    <script
      src="https://unpkg.com/esri-leaflet@2.3.3/dist/esri-leaflet.js"
      integrity="sha512-cMQ5e58BDuu1pr9BQ/eGRn6HaR6Olh0ofcHFWe5XesdCITVuSBiBZZbhCijBe5ya238f/zMMRYIMIIg1jxv4sQ=="
      crossorigin=""
    ></script>

    <!-- Load Esri Leaflet Geocoder from CDN -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/esri-leaflet-geocoder@2.3.2/dist/esri-leaflet-geocoder.css"
      integrity="sha512-IM3Hs+feyi40yZhDH6kV8vQMg4Fh20s9OzInIIAc4nx7aMYMfo+IenRUekoYsHZqGkREUgx0VvlEsgm7nCDW9g=="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/esri-leaflet-geocoder@2.3.2/dist/esri-leaflet-geocoder.js"
      integrity="sha512-8twnXcrOGP3WfMvjB0jS5pNigFuIWj4ALwWEgxhZ+mxvjF5/FBPVd5uAxqT8dd2kUmTVK9+yQJ4CmTmSg/sXAQ=="
      crossorigin=""
    ></script>
    
<style>
  input:invalid {
  border: 2px dashed red;
}

  input:valid {
  border: 1px solid black;
}
    .conteneur {
    display: flex;
    flex-flow : row wrap;
    justify-content: space-around;
    }
    .contenu {
    min-width: 600px;
    height: 600px;
    }

    .checkbox_box{
    column-width: 7rem;
    flex-grow: 2;
    height: 500px;
    }   
</style>
<br><br>
<h1>Je recherche... </h1>
<br><br>
<div class="conteneur">
  <div class="contenu">
    <form method="post" >
      <div>
        <input type="radio" id="Male" name="sexe" value="Male" {% if sex_to_find=='Male' %} checked {% endif %}>
        <label for="Male">un homme</label>
        <input type="radio" id="Female" name="sexe" value="Female" {% if sex_to_find=='Female' %} checked {% endif %}>
        <label for="Female">une femme</label>&emsp;&emsp;&emsp;&emsp;&emsp;
        <button type="submit" class="btn btn-primary btn-lg mb-2" >Chercher</button>
      </div><br>
      <table>
        <tr><td>Age compris entre </td><td><input type="number" name="agemin" min="18" max="110" size =8/> et  <input type="number" name="agemax" min="18" max="110" size =8 /></td></tr>
        <tr><td>Popularite  entre </td><td><input type="number" name="popmin" min="0" max="100" value=0 /> et  <input type="number" value=100 name="popmax" min="0" max="100" /></td></tr> 
      </table>  
        <p>Localisation <input type="hidden" name="longlat" id="coor" visible =false> dans un rayon de <input type="number" name='km' value =20 min="0" max="20000" >kms autour de votre position, <br> ou bien autour de la ville choisie sur la carte</p>
    <br><strong>Centres d'interets :</strong><br><br>
      <div class="checkbox_box">
          <fieldset>
          {% for topic in topics %}
            <input type="checkbox" id={{topic}} name="interest" value={{topic}} /><label for={{topic}}>{{topic}}</label><br>
          {% endfor %}
        </fieldset>
      </div>
    
    </form>
  </div><div id="map" class="contenu">

</div>
    <script>
      var map = L.map("map").setView([{{latitude}},{{longitude}}], 9);
      var tiles = L.esri.basemapLayer("Streets").addTo(map);

      // create the geocoding control and add it to the map
      var searchControl = L.esri.Geocoding.geosearch({
        providers: [
          L.esri.Geocoding.arcgisOnlineProvider({
            // API Key to be passed to the ArcGIS Online Geocoding Service
            apikey: 'AAPKfaf63277666a420e99b58b0f3684d806TGgoleiMaxVY4JXkzFkR2DPMte6T7IZyAr_3z7MtSTrc-ROCRaMZUCln3xrBz2KS'
          })
        ]
      }).addTo(map);

      // create an empty layer group to store the results and add it to the map
      var results = L.layerGroup().addTo(map);

      // listen for the results event and add every result to the map
      searchControl.on("results", function (data) {
        results.clearLayers();
        for (var i = data.results.length - 1; i >= 0; i--) {
          results.addLayer(L.marker(data.results[i].latlng));
        document.getElementById('coor').value=data.results[i].latlng;}
        
      });

      //manual marker add
      var marker = L.marker([{{latitude}}, {{longitude}}]).addTo(map);
      map.on('click', placerMarqueur);

      function placerMarqueur(e) {
        results.clearLayers();
        marker.setLatLng(e.latlng);
        document.getElementById('coor').value=e.latlng;
      };
    </script>
<br>

{% endblock %}